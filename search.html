<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S-CLOUD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-background {
            background: linear-gradient(to bottom right, #1a202c, #2d3748);
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #2d3748;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #4a5568;
            border-radius: 4px;
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen pb-24 gradient-background">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-center">S-CLOUD</h1>
        </header>

        <div class="bg-gray-800 rounded-lg p-6 mb-8">
            <form id="search-form" class="flex flex-col sm:flex-row gap-4">
                <input type="text" id="saavn-search-box" placeholder="Search for songs..." class="flex-grow p-3 rounded-lg text-gray-900 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">Search</button>
            </form>
            <select id="saavn-bitrate" class="mt-4 p-3 rounded-lg text-gray-900 bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="4">320 kbps</option>
                <option value="3">160 kbps</option>
            </select>
        </div>

        <div id="saavn-results" class="grid grid-cols-1 md:grid-cols-3 gap-4 custom-scrollbar" style="max-height: 60vh; overflow-y: auto;">
            <!-- Search results will be dynamically inserted here -->
        </div>

        <button id="loadmore" class="mt-8 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 mx-auto block">Load More</button>
    </div>

    <footer class="fixed bottom-0 left-0 right-0 bg-gray-800 shadow-lg">
        <div id="progress-container" class="h-1 bg-gray-600">
            <div id="progress" class="h-full bg-blue-500 w-0"></div>
        </div>
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center">
                <img id="player-image" src="/api/placeholder/48/48" alt="Album cover" class="w-12 h-12 rounded-lg shadow-md mr-4">
                <div>
                    <p id="player-name" class="font-semibold text-sm">Song Name</p>
                    <p id="player-album" class="text-xs text-gray-400">Album Name</p>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <button id="play-pause" class="bg-blue-500 hover:bg-blue-600 text-white rounded-full p-2 transition duration-300">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                    </svg>
                </button>
                <div class="flex items-center">
                    <div class="lofi-toggle w-12 h-6 bg-gray-600 rounded-full flex items-center p-1 cursor-pointer">
                        <div class="lofi-toggle-knob w-4 h-4 bg-white rounded-full transition-transform duration-300"></div>
                    </div>
                    <span class="ml-2 text-sm font-medium">Lofi</span>
                </div>
                <div class="text-xs">
                    <span id="current-time">0:00</span>
                    <span>/</span>
                    <span id="duration">0:00</span>
                </div>
            </div>
        </div>
    </footer>

    <audio id="player" crossorigin="anonymous">
        <source id="audioSource" src="" type="audio/mp3">
    </audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web-audio-api/2.0.0/audioworklet.min.js"></script>
    <script src="assets/js/functions.js"></script>
    <script src="assets/js/saavn-search.js"></script>
    <script>
    let audioContext;
    let sourceNode;
    let reverbNode;
    let slowedReverbEnabled = false;

    document.getElementById('search-form').addEventListener('submit', function(event) {
        event.preventDefault();
        const results = SaavnSearch();
        displayResults(results);
    });

    function displayResults(results) {
        const resultsContainer = document.getElementById('saavn-results');
        resultsContainer.innerHTML = '';
        
        results.forEach(song => {
            const songElement = document.createElement('div');
            songElement.className = 'bg-gray-800 rounded-lg overflow-hidden shadow-lg transition-transform duration-300 hover:scale-105 flex items-center';
            songElement.innerHTML = `
                <img src="${song.image}" alt="${song.name}" class="w-16 h-16 object-cover" id="${song.id}-i">
                <div class="p-4 flex-grow">
                    <h3 class="font-semibold text-sm mb-1" id="${song.id}-n">${song.name}</h3>
                    <p class="text-gray-400 text-xs" id="${song.id}-a">${song.album}</p>
                </div>
            `;
            songElement.addEventListener('click', () => PlayAudio(song.url, song.id));
            resultsContainer.appendChild(songElement);
        });
    }

    function PlayAudio(audio_url, song_id) {
        var source = document.getElementById('audioSource');
        source.src = audio_url;
        var name = document.getElementById(song_id+"-n").textContent;
        var album = document.getElementById(song_id+"-a").textContent;
        var image = document.getElementById(song_id+"-i").getAttribute("src");
        
        document.title = name+" - "+album;
        document.getElementById("player-name").textContent = name;
        document.getElementById("player-album").textContent = album;
        document.getElementById("player-image").src = image;

        var promise = audio.load();
        if (promise) {
            promise.catch(function(error) { console.error(error); });
        }
        audio.play();
        updatePlayPauseButton(true);

        if (slowedReverbEnabled) {
            applySlowedReverbEffect();
        } else {
            removeSlowedReverbEffect();
        }
    }

    document.getElementById('loadmore').addEventListener('click', function() {
        const results = SaavnSearch();
        displayResults(results);
    });

    const audio = document.getElementById('player');
    const progressBar = document.getElementById('progress-container');
    const progress = document.getElementById('progress');
    const currentTimeElement = document.getElementById('current-time');
    const durationElement = document.getElementById('duration');
    const playPauseButton = document.getElementById('play-pause');
    const slowedReverbToggle = document.querySelector('.lofi-toggle');

    playPauseButton.addEventListener('click', togglePlayPause);
    audio.addEventListener('timeupdate', updateProgress);
    audio.addEventListener('loadedmetadata', () => {
        durationElement.textContent = formatTime(audio.duration);
    });
    progressBar.addEventListener('click', seek);
    slowedReverbToggle.addEventListener('click', toggleSlowedReverb);

    function togglePlayPause() {
        if (audio.paused) {
            audio.play();
            updatePlayPauseButton(true);
        } else {
            audio.pause();
            updatePlayPauseButton(false);
        }
    }

    function updatePlayPauseButton(isPlaying) {
        playPauseButton.innerHTML = isPlaying
            ? '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" /></svg>'
            : '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>';
    }

    function updateProgress() {
        const progressPercent = (audio.currentTime / audio.duration) * 100;
        progress.style.width = `${progressPercent}%`;
        currentTimeElement.textContent = formatTime(audio.currentTime);
    }

    function seek(e) {
        const progressWidth = this.clientWidth;
        const clickX = e.offsetX;
        const duration = audio.duration;
        audio.currentTime = (clickX / progressWidth) * duration;
    }

    function formatTime(time) {
        const minutes = Math.floor(time / 60);
        const seconds = Math.floor(time % 60);
        return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }

    function toggleSlowedReverb() {
        slowedReverbEnabled = !slowedReverbEnabled;
        const toggle = document.querySelector('.lofi-toggle');
        const knob = document.querySelector('.lofi-toggle-knob');
        
        if (slowedReverbEnabled) {
            toggle.classList.add('active');
            knob.style.transform = 'translateX(24px)';
            applySlowedReverbEffect();
        } else {
            toggle.classList.remove('active');
            knob.style.transform = 'translateX(0)';
            removeSlowedReverbEffect();
        }
    }

    function applySlowedReverbEffect() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            sourceNode = audioContext.createMediaElementSource(audio);
        }

        if (!reverbNode) {
            reverbNode = audioContext.createConvolver();
            const impulseLength = 1 * audioContext.sampleRate;
            const impulse = audioContext.createBuffer(2, impulseLength, audioContext.sampleRate);
            const left = impulse.getChannelData(0);
            const right = impulse.getChannelData(1);
            for (let i = 0; i < impulseLength; i++) {
                left[i] = right[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / impulseLength, 2);
            }
            reverbNode.buffer = impulse;
        }

        const gainNode = audioContext.createGain();
        gainNode.gain.setValueAtTime(0.6, audioContext.currentTime);

        audio.preservesPitch = false;
        audio.playbackRate = 0.8;

        sourceNode.disconnect();
        sourceNode.connect(gainNode);
        gainNode.connect(audioContext.destination);
        sourceNode.connect(reverbNode);
        reverbNode.connect(audioContext.destination);
    }

    function removeSlowedReverbEffect() {
        audio.playbackRate = 1;
        audio.preservesPitch = true;

        if (sourceNode) {
            sourceNode.disconnect();
            if (reverbNode) {
                reverbNode.disconnect();
            }
            sourceNode.connect(audioContext.destination);
        }
    }
    </script>
</body>
</html>
