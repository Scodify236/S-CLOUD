<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S-CLOUD | Liquid</title>
    <link rel="icon" type="image/webp" href="logo.webp">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'blob': 'blob 7s infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                },
            },
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            overflow-x: hidden;
        }

        /* Ambient Background Glow */
        .ambient-light {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: 
                radial-gradient(circle at 15% 50%, rgba(59, 130, 246, 0.15), transparent 25%),
                radial-gradient(circle at 85% 30%, rgba(147, 51, 234, 0.15), transparent 25%);
            z-index: -1;
            pointer-events: none;
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        /* Scrollbar Hiding */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Custom Range Slider for Lofi */
        .lofi-toggle.active { background-color: rgba(59, 130, 246, 0.8); box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); }
        
        /* Audio visualizer bars animation */
        .playing-indicator span {
            animation: bounce 2.2s ease infinite alternate;
        }
        .playing-indicator span:nth-of-type(2) { animation-delay: -2.2s; }
        .playing-indicator span:nth-of-type(3) { animation-delay: -3.7s; }
        @keyframes bounce { 10% { transform: scaleY(0.3); } 30% { transform: scaleY(1); } 60% { transform: scaleY(0.5); } 80% { transform: scaleY(0.75); } 100% { transform: scaleY(0.6); } }
    </style>
</head>
<body class="text-white min-h-screen selection:bg-blue-500 selection:text-white">

    <div class="ambient-light"></div>

    <header class="fixed top-4 left-4 right-4 z-50">
        <div class="glass-panel rounded-3xl max-w-7xl mx-auto px-6 py-4">
            <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 rounded-full bg-red-500"></div>
                    <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                    <div class="w-3 h-3 rounded-full bg-green-500"></div>
                    <h1 class="ml-4 text-xl font-bold tracking-tight bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">S-CLOUD</h1>
                </div>

                <form id="search-form" class="flex-1 max-w-xl w-full relative group">
                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-gray-400 group-focus-within:text-blue-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                        </svg>
                    </div>
                    <input type="text" id="saavn-search-box" placeholder="Search tracks, artists..." 
                        class="w-full bg-white/5 border border-white/10 text-white rounded-2xl py-2.5 pl-12 pr-4 focus:outline-none focus:bg-white/10 focus:border-blue-500/50 transition-all placeholder-gray-500 text-sm">
                </form>

                <div class="flex items-center gap-4">
                    <select id="saavn-bitrate" class="bg-black/20 border border-white/10 text-xs text-gray-300 rounded-xl px-3 py-2 outline-none focus:border-blue-500 transition-colors cursor-pointer">
                        <option value="4">High (320kbps)</option>
                        <option value="3">Med (160kbps)</option>
                    </select>
                </div>
            </div>

            <div class="flex gap-2 overflow-x-auto hide-scrollbar mt-4 pb-1 mask-linear">
                <button class="search-query-button whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition-all text-gray-300 hover:text-white">Hindi</button>
                <button class="search-query-button whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition-all text-gray-300 hover:text-white">English</button>
                <button class="search-query-button whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition-all text-gray-300 hover:text-white">Lo-Fi</button>
                <button class="search-query-button whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition-all text-gray-300 hover:text-white">Punjabi</button>
                <button class="search-query-button whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition-all text-gray-300 hover:text-white">Trending</button>
                <button class="search-query-button whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition-all text-gray-300 hover:text-white">Arijit Singh</button>
                <button class="search-query-button whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition-all text-gray-300 hover:text-white">The Weeknd</button>
                <button class="search-query-button whitespace-nowrap px-4 py-1.5 rounded-full text-xs font-medium bg-white/5 border border-white/5 hover:bg-white/10 hover:border-white/20 transition-all text-gray-300 hover:text-white">Sidhu Moose Wala</button>
            </div>
        </div>
    </header>

    <main class="pt-44 pb-36 px-4 max-w-7xl mx-auto">
        <h2 class="text-2xl font-bold mb-6 text-white/90 px-2">Discover</h2>
        <div id="saavn-results" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6">
            </div>
        
        <div class="flex justify-center mt-12">
            <button id="loadmore" class="glass-panel px-8 py-3 rounded-full text-sm font-semibold hover:bg-white/10 transition-all text-blue-400 hover:text-blue-300">Load More Music</button>
        </div>
    </main>

    <footer class="fixed bottom-6 left-4 right-4 z-50">
        <div class="glass-panel max-w-4xl mx-auto rounded-[2rem] p-3 shadow-2xl overflow-hidden relative group">
            
            <div id="progress-container" class="absolute top-0 left-0 right-0 h-1 bg-white/5 cursor-pointer z-10 group-hover:h-2 transition-all">
                <div id="progress" class="h-full bg-gradient-to-r from-blue-500 to-purple-500 w-0 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>
            </div>

            <div class="flex items-center justify-between pl-2 pr-4 pt-2">
                
                <div class="flex items-center flex-1 min-w-0 mr-4">
                    <div class="relative group/img">
                        <img id="player-image" src="https://via.placeholder.com/150" alt="Cover" class="w-14 h-14 rounded-2xl object-cover shadow-lg border border-white/10">
                        <div class="absolute inset-0 bg-black/40 rounded-2xl flex items-center justify-center opacity-0 group-hover/img:opacity-100 transition-opacity">
                            <div class="playing-indicator flex gap-0.5 h-3 items-end">
                                <span class="w-1 bg-white rounded-full h-full"></span>
                                <span class="w-1 bg-white rounded-full h-full"></span>
                                <span class="w-1 bg-white rounded-full h-full"></span>
                            </div>
                        </div>
                    </div>
                    <div class="ml-4 min-w-0 flex-col flex">
                        <p id="player-name" class="font-semibold text-white text-sm truncate">Select a song</p>
                        <p id="player-album" class="text-xs text-gray-400 truncate">S-Cloud Player</p>
                    </div>
                </div>

                <div class="flex items-center gap-4 md:gap-6">
                    <div class="hidden sm:flex items-center gap-2 group/lofi cursor-pointer" onclick="document.querySelector('.lofi-toggle').click()">
                        <div class="lofi-toggle w-10 h-6 bg-black/40 rounded-full p-1 transition-all duration-300 border border-white/10">
                            <div class="lofi-toggle-knob w-4 h-4 bg-gray-400 rounded-full shadow-sm transition-transform duration-300"></div>
                        </div>
                        <span class="text-[10px] font-bold tracking-wider text-gray-500 group-hover/lofi:text-gray-300 uppercase">Slowed</span>
                    </div>

                    <button id="play-pause" class="w-12 h-12 bg-white text-black rounded-full flex items-center justify-center hover:scale-105 transition-transform shadow-[0_0_20px_rgba(255,255,255,0.3)]">
                        <svg class="w-5 h-5 ml-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" />
                        </svg>
                    </button>

                    <div class="text-[10px] font-mono text-gray-400 hidden sm:block w-20 text-right">
                        <span id="current-time">0:00</span> / <span id="duration">0:00</span>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <audio id="player" crossorigin="anonymous">
        <source id="audioSource" src="" type="audio/mp3">
    </audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        let audioContext;
        let sourceNode;
        let reverbNode;
        let slowedReverbEnabled = false;
        let lastSearch = '';
        
        document.getElementById('search-form').addEventListener('submit', function(event) {
            event.preventDefault();
            SaavnSearch();
        });

        function handleSearchQueryClick(query) {
            document.querySelector("#saavn-search-box").value = query;
            SaavnSearch();
        }

        document.querySelectorAll('.search-query-button').forEach(button => {
            button.addEventListener('click', function() {
                handleSearchQueryClick(this.textContent);
            });
        });

        var results_container = document.querySelector("#saavn-results");
        var results_objects = {};
        const searchUrl = "https://jiosaavn-api-privatecvc2.vercel.app/search/songs?query=";

        function SaavnSearch() {
            var query = document.querySelector("#saavn-search-box").value.trim();
            query = encodeURIComponent(query);
            if (query.length > 0) {
                window.location.hash = query;
                doSaavnSearch(query);
            }
        }

        var page_index = 1;
        function nextPage() {
            var query = document.querySelector("#saavn-search-box").value.trim();
            if (!query) query = lastSearch;
            query = encodeURIComponent(query);
            doSaavnSearch(query, 0, true);
        }

        async function doSaavnSearch(query, NotScroll, page) {
            window.location.hash = query;
            document.querySelector("#saavn-search-box").value = decodeURIComponent(query);
            if (!query) return;

            if (!page) {
                results_container.innerHTML = `<div class="col-span-full flex flex-col items-center justify-center py-20 text-gray-500">
                    <div class="w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                    <p>Fetching beats...</p>
                </div>`;
            }

            query = query + "&limit=40";
            if (page) {
                page_index++;
                query = query + "&page=" + page_index;
            } else {
                query = query + "&page=1";
                page_index = 1;
                results_container.innerHTML = '';
            }

            try {
                var response = await fetch(searchUrl + query);
                var json = await response.json();
                if (response.status !== 200) throw new Error(json.message);
                var results = json.data.results;
                if (!results || results.length === 0) {
                    results_container.innerHTML = "<p class='col-span-full text-center text-gray-500 py-10'>No music found.</p>";
                    return;
                }
                lastSearch = decodeURI(window.location.hash.substring(1));
                displayResults(results);
            } catch (error) {
                results_container.innerHTML = `<div class="col-span-full text-center text-red-400 py-10">Error loading music.</div>`;
                console.error(error);
            }

            if (!NotScroll) {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function displayResults(results) {
            let resultsHTML = '';
            for (let track of results) {
                let song_name = track.name;
                let album_name = track.album.name == track.name ? "" : track.album.name;
                let play_time = formatTime(track.duration);
                let song_id = track.id;
                let year = track.year;
                let song_image = track.image[2].link;
                let song_artist = track.primaryArtists;
                let bitrate = document.getElementById('saavn-bitrate');
                let bitrate_i = bitrate.options[bitrate.selectedIndex].value;
                
                if (track.downloadUrl) {
                    let download_url = track.downloadUrl[bitrate_i]['link'];
                    results_objects[song_id] = { track: track };
                    
                    resultsHTML += `
                    <div class="glass-card rounded-3xl overflow-hidden cursor-pointer group relative" data-song-id="${song_id}" data-download-url="${download_url}">
                        <div class="aspect-square overflow-hidden relative">
                            <img src="${song_image}" alt="${song_name}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/40 transition-colors flex items-center justify-center opacity-0 group-hover:opacity-100 backdrop-blur-[2px]">
                                <div class="w-12 h-12 bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center border border-white/30 text-white">
                                    <svg class="w-6 h-6 ml-1" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                                </div>
                            </div>
                            <span class="absolute bottom-2 right-2 text-[10px] font-bold bg-black/60 backdrop-blur-md text-white px-2 py-0.5 rounded-md border border-white/10">${play_time}</span>
                        </div>
                        <div class="p-4">
                            <h3 class="font-bold text-sm text-white truncate group-hover:text-blue-400 transition-colors">${song_name}</h3>
                            <p class="text-xs text-gray-400 truncate mt-1">${song_artist}</p>
                            <p class="text-[10px] text-gray-600 mt-2 flex justify-between"><span>${year}</span> <span>${album_name}</span></p>
                        </div>
                    </div>
                    `;
                }
            }
            results_container.innerHTML += resultsHTML;

            document.querySelectorAll('.glass-card').forEach(container => {
                container.addEventListener('click', function() {
                    PlayAudio(this.dataset.downloadUrl, this.dataset.songId);
                });
            });
        }

        function PlayAudio(audio_url, song_id) {
            var source = document.getElementById('audioSource');
            source.src = audio_url;
            var track = results_objects[song_id].track;
            
            document.title = track.name + " â€¢ S-CLOUD";
            document.getElementById("player-name").textContent = track.name;
            document.getElementById("player-album").textContent = track.primaryArtists; // Showing artist instead of album for cleaner look
            document.getElementById("player-image").src = track.image[2].link;

            var audio = document.getElementById('player');
            audio.load();
            audio.play().catch(e => console.error(e));
            updatePlayPauseButton(true);

            if (slowedReverbEnabled) applySlowedReverbEffect();
            else removeSlowedReverbEffect();
        }

        document.getElementById('loadmore').addEventListener('click', nextPage);

        const audio = document.getElementById('player');
        const progressBar = document.getElementById('progress-container');
        const progress = document.getElementById('progress');
        const currentTimeElement = document.getElementById('current-time');
        const durationElement = document.getElementById('duration');
        const playPauseButton = document.getElementById('play-pause');
        const slowedReverbToggle = document.querySelector('.lofi-toggle');

        playPauseButton.addEventListener('click', togglePlayPause);
        audio.addEventListener('timeupdate', updateProgress);
        audio.addEventListener('loadedmetadata', () => {
            durationElement.textContent = formatTime(audio.duration);
        });
        progressBar.addEventListener('click', seek);
        slowedReverbToggle.addEventListener('click', toggleSlowedReverb);

        function togglePlayPause() {
            if (audio.paused) {
                audio.play();
                updatePlayPauseButton(true);
            } else {
                audio.pause();
                updatePlayPauseButton(false);
            }
        }

        function updatePlayPauseButton(isPlaying) {
            playPauseButton.innerHTML = isPlaying
                ? '<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" /></svg>'
                : '<svg class="w-6 h-6 ml-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z" /></svg>';
        }

        function updateProgress() {
            if (!isNaN(audio.duration)) {
                const progressPercent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = `${progressPercent}%`;
                currentTimeElement.textContent = formatTime(audio.currentTime);
            }
        }

        function seek(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audio.duration;
            audio.currentTime = (clickX / width) * duration;
        }

        function formatTime(time) {
            if(isNaN(time)) return "0:00";
            const minutes = Math.floor(time / 60);
            const seconds = Math.floor(time % 60);
            return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function toggleSlowedReverb() {
            slowedReverbEnabled = !slowedReverbEnabled;
            const toggle = document.querySelector('.lofi-toggle');
            const knob = document.querySelector('.lofi-toggle-knob');
            
            if (slowedReverbEnabled) {
                toggle.classList.add('active');
                knob.style.transform = 'translateX(16px)';
                knob.style.backgroundColor = '#ffffff';
                applySlowedReverbEffect();
            } else {
                toggle.classList.remove('active');
                knob.style.transform = 'translateX(0)';
                knob.style.backgroundColor = '#9ca3af';
                removeSlowedReverbEffect();
            }
        }

        function applySlowedReverbEffect() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                sourceNode = audioContext.createMediaElementSource(audio);
            }
            if (!reverbNode) {
                reverbNode = audioContext.createConvolver();
                const length = audioContext.sampleRate * 3; 
                const impulse = audioContext.createBuffer(2, length, audioContext.sampleRate);
                for (let channel = 0; channel < 2; channel++) {
                    const data = impulse.getChannelData(channel);
                    for (let i = 0; i < length; i++) {
                        data[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / length, 2);
                    }
                }
                reverbNode.buffer = impulse;
            }

            const gainNode = audioContext.createGain();
            gainNode.gain.value = 0.7; // Mix wet/dry

            audio.preservesPitch = false;
            audio.playbackRate = 0.88; // Slowed down

            sourceNode.disconnect();
            sourceNode.connect(gainNode);
            gainNode.connect(audioContext.destination); // Dry
            sourceNode.connect(reverbNode);
            reverbNode.connect(audioContext.destination); // Wet
        }

        function removeSlowedReverbEffect() {
            audio.playbackRate = 1;
            audio.preservesPitch = true;
            if (sourceNode) {
                sourceNode.disconnect();
                sourceNode.connect(audioContext.destination);
            }
        }

        // Init
        if (window.location.hash) doSaavnSearch(window.location.hash.substring(1));
        else doSaavnSearch('hindi', 1);

        window.addEventListener('hashchange', () => doSaavnSearch(window.location.hash.substring(1)));
        document.getElementById('saavn-bitrate').addEventListener('change', () => doSaavnSearch(lastSearch));
    </script>
</body>
</html>
