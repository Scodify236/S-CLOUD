<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S-CLOUD</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
:root {
  --primary-bg: #121212;
  --secondary-bg: #181818;
  --tertiary-bg: #282828;
  --primary-text: #ffffff;
  --secondary-text: #b3b3b3;
  --accent-color: #1db954;
  --hover-bg: #282828;
}

body {
  background-color: var(--primary-bg);
  color: var(--primary-text);
  font-family: 'Inter', sans-serif;
  margin: 0;
  padding: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  font-size: 16px;
  line-height: 1.6;
}

header {
  background-color: var(--primary-bg);
  padding: 1rem;
  border-bottom: 1px solid var(--tertiary-bg);
}

main {
  flex-grow: 1;
  padding: 1rem;
  margin-bottom: 90px;
}

.search-container {
  background-color: var(--secondary-bg);
  border-radius: 4px;
  padding: 0.5rem;
  margin-bottom: 1rem;
}

#saavn-search-box {
  background-color: var(--tertiary-bg);
  border: none;
  color: var(--primary-text);
  padding: 0.5rem 1rem;
  border-radius: 4px;
  width: 100%;
}

#saavn-bitrate {
  display: none;
}

#loadmore {
  display: none;
}

.results-container {
  background-color: var(--secondary-bg);
  border-radius: 4px;
  padding: 0.5rem;
  overflow-y: auto;
  max-height: calc(100vh - 200px);
}

.song-container {
  display: flex;
  align-items: center;
  padding: 0.5rem;
  border-radius: 4px;
  margin-bottom: 0.5rem;
  transition: background-color 0.3s;
}

.song-container:hover {
  background-color: var(--hover-bg);
}

.song-image img {
  width: 40px;
  height: 40px;
  border-radius: 4px;
  margin-right: 1rem;
}

.song-info {
  flex-grow: 1;
}

.song-name {
  font-size: 1rem;
  font-weight: 500;
  margin: 0;
}

.song-artist, .album-name {
  font-size: 0.8rem;
  color: var(--secondary-text);
  margin: 0;
}

.player {
  background-color: transparent(5px);
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  height: auto;
}

.progress-bar {
  background-color: var(--tertiary-bg);
  height: 4px;
  width: 100%;
  margin: 0;
}

.progress {
  background-color: var(--accent-color);
  height: 100%;
  width: 0;
}

.player-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1rem;
}

.player-left {
  display: flex;
  align-items: center;
}

#player-image {
  width: 56px;
  height: 56px;
  border-radius: 4px;
  margin-right: 1rem;
}

.player-info {
  display: flex;
  flex-direction: column;
}

#player-name {
  font-size: 0.9rem;
  font-weight: 500;
  margin: 0;
}

#player-album {
  font-size: 0.8rem;
  color: var(--secondary-text);
  margin: 0;
}

.player-controls {
  display: flex;
  align-items: center;
}

.control-button {
  background-color: transparent;
  border: none;
  color: var(--primary-text);
  cursor: pointer;
  margin: 0 0.5rem;
}

.lofi-toggle {
  margin-left: 1rem;
}

.player-right {
  display: flex;
  align-items: center;
}

.time-display {
  display: flex;
  font-size: 0.8rem;
  color: var(--secondary-text);
}

#current-time {
  margin-right: 0.5rem;
}

#duration {
  margin-left: 0.5rem;
}

.lofi-toggle {
  background-color: var(--tertiary-bg);
  width: 40px;
  height: 20px;
  border-radius: 10px;
  margin-left: 1rem;
  position: relative;
  cursor: pointer;
}

.lofi-toggle-knob {
  background-color: var(--primary-text);
  width: 16px;
  height: 16px;
  border-radius: 50%;
  position: absolute;
  top: 2px;
  left: 2px;
  transition: transform 0.3s;
}

.lofi-toggle.active .lofi-toggle-knob {
  transform: translateX(20px);
}

nav {
  background-color: var(--primary-bg);
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around;
  padding: 0.5rem;
  border-top: 1px solid var(--tertiary-bg);
}

nav a {
  color: var(--secondary-text);
  text-decoration: none;
  font-size: 0.8rem;
  display: flex;
  flex-direction: column;
  align-items: center;
}

nav a.active {
  color: var(--primary-text);
}

nav svg {
  width: 24px;
  height: 24px;
  margin-bottom: 0.25rem;
}

/* Custom scrollbar */
.custom-scrollbar {
  scrollbar-width: thin;
  scrollbar-color: var(--tertiary-bg) var(--secondary-bg);
}

.custom-scrollbar::-webkit-scrollbar {
  width: 8px;
}

.custom-scrollbar::-webkit-scrollbar-track {
  background: var(--secondary-bg);
}

.custom-scrollbar::-webkit-scrollbar-thumb {
  background-color: var(--tertiary-bg);
  border-radius: 4px;
  border: 2px solid var(--secondary-bg);
}

/* Animations */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.fade-in {
  animation: fadeIn 0.5s ease-in-out;
}

/* Responsive design */
@media (max-width: 768px) {
  .player-content {
    flex-direction: column;
    align-items: stretch;
    padding: 0.5rem;
  }

  .player-controls {
    margin-top: 0.5rem;
    justify-content: center;
  }

  .player-right {
    margin-top: 0.25rem;
    justify-content: center;
  }

  #player-image {
    width: 40px;
    height: 40px;
  }

  .player-info {
    flex-grow: 1;
  }

  #player-name {
    font-size: 0.8rem;
  }

  #player-album {
    font-size: 0.7rem;
  }

  .control-button {
    width: 40px;
    height: 40px;
  }

  .lofi-toggle {
    width: 32px;
    height: 16px;
  }

  .lofi-toggle-knob {
    width: 12px;
    height: 12px;
  }

  .lofi-toggle.active .lofi-toggle-knob {
    transform: translateX(16px);
  }

  .time-display {
    font-size: 0.7rem;
  }
}

/* Additional styles from the original CSS */
.control-button {
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  transition: all 0.3s;
}

.control-button:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
}

.control-button:active {
  animation: pulse 0.3s ease-in-out;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

::selection {
  background-color: rgba(29, 185, 84, 0.3);
}

.glass-effect {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

@keyframes float {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-3px); }
  100% { transform: translateY(0px); }
}

.float-animation {
  animation: float 4s ease-in-out infinite;
}

/* Additional styles from the original CSS */
.control-button {
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  transition: all 0.3s;
}

.control-button:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.5);
}

.control-button:active {
  animation: pulse 0.3s ease-in-out;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

::selection {
  background-color: rgba(29, 185, 84, 0.3);
}

.glass-effect {
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(10px);
  border-radius: 16px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

@keyframes float {
  0% { transform: translateY(0px); }
  50% { transform: translateY(-3px); }
  100% { transform: translateY(0px); }
}

.float-animation {
  animation: float 4s ease-in-out infinite;
}
    </style>
</head>
<body class="min-h-screen flex flex-col gradient-background">
    <header class="p-4 flex items-center">
        <img src="logo.webp" alt="S-CLOUD Logo" class="w-8 h-8 mr-2">
        <h1 class="text-2xl font-bold">S-CLOUD</h1>
    </header>

    <main class="flex-grow p-4">
        <div class="search-container rounded-lg p-4 mb-4 shadow-lg">
            <form id="search-form" class="flex">
                <input type="text" id="saavn-search-box" placeholder="Search for songs..." class="flex-grow p-2 rounded-l-lg text-black focus:outline-none focus:ring-2 focus:ring-blue-500">
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-r-lg transition duration-300">Search</button>
            </form>
            <select id="saavn-bitrate" class="mt-2 p-2 rounded text-black focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="4">320 kbps</option>
                <option value="3">160 kbps</option>
            </select>
            <button id="loadmore" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white p-2 rounded transition duration-300 shadow">Load More</button>
        </div>

        <div id="saavn-results" class="results-container rounded-lg p-4 overflow-y-auto custom-scrollbar shadow-lg" style="max-height: 60vh;">
            <!-- Search results will be dynamically inserted here -->
        </div>
    </main>

    <footer class="player fixed bottom-0 left-0 right-0 shadow-lg">
        <div id="progress-container" class="progress-bar">
            <div id="progress" class="progress"></div>
        </div>
        <div class="player-content">
            <div class="player-left">
                <img id="player-image" src="/api/placeholder/64/64" alt="Album cover" class="shadow-md">
                <div class="player-info">
                    <p id="player-name" class="font-semibold">Song Name</p>
                    <p id="player-album" class="text-sm text-gray-400">Album Name</p>
                </div>
            </div>
            <div class="player-controls">
                <button id="play-pause" class="control-button rounded-full p-2">
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" />
                    </svg>
                </button>
                <div class="lofi-toggle w-12 h-6 rounded-full flex items-center p-1 cursor-pointer">
                    <div class="lofi-toggle-knob w-4 h-4 rounded-full"></div>
                </div>
                <span class="ml-2 text-sm">Lofi</span>
            </div>
            <div class="player-right">
                <div class="time-display">
                    <span id="current-time">0:00</span>
                    <span>/</span>
                    <span id="duration">0:00</span>
                </div>
            </div>
        </div>
    </footer>

    <audio id="player" crossorigin="anonymous">
        <source id="audioSource" src="" type="audio/mp3">
    </audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/web-audio-api/2.0.0/audioworklet.min.js"></script>
    <script src="assets/js/functions.js"></script>
    <script src="assets/js/saavn-search.js"></script>
    <script>
let audioContext;
let sourceNode;
let reverbNode;
let slowedReverbEnabled = false;

const audio = document.getElementById('player');
const progressBar = document.getElementById('progress-container');
const progress = document.getElementById('progress');
const currentTimeElement = document.getElementById('current-time');
const durationElement = document.getElementById('duration');
const slowedReverbToggle = document.querySelector('.lofi-toggle');

document.getElementById('search-form').addEventListener('submit', function(event) {
    event.preventDefault();
    SaavnSearch();
});

document.getElementById('play-pause').addEventListener('click', togglePlayPause);

audio.addEventListener('timeupdate', updateProgress);
audio.addEventListener('loadedmetadata', () => {
    durationElement.textContent = formatTime(audio.duration);
});

progressBar.addEventListener('click', seek);

slowedReverbToggle.addEventListener('click', toggleSlowedReverb);

function togglePlayPause() {
    if (audio.paused) {
        audio.play();
        updatePlayPauseButton(true);
    } else {
        audio.pause();
        updatePlayPauseButton(false);
    }
}

function updatePlayPauseButton(isPlaying) {
    const button = document.getElementById('play-pause');
    button.innerHTML = isPlaying
        ? '<svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8 7a1 1 0 00-1 1v4a1 1 0 001 1h4a1 1 0 001-1V8a1 1 0 00-1-1H8z" clip-rule="evenodd" /></svg>'
        : '<svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd" /></svg>';
}

function updateProgress() {
    const progressPercent = (audio.currentTime / audio.duration) * 100;
    progress.style.width = `${progressPercent}%`;
    currentTimeElement.textContent = formatTime(audio.currentTime);
}

function seek(e) {
    const progressWidth = this.clientWidth;
    const clickX = e.offsetX;
    const duration = audio.duration;
    audio.currentTime = (clickX / progressWidth) * duration;
}

function formatTime(time) {
    const minutes = Math.floor(time / 60);
    const seconds = Math.floor(time % 60);
    return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
}

function toggleSlowedReverb() {
    slowedReverbEnabled = !slowedReverbEnabled;
    const toggle = document.querySelector('.lofi-toggle');
    const knob = document.querySelector('.lofi-toggle-knob');
    
    if (slowedReverbEnabled) {
        toggle.classList.add('active');
        knob.style.transform = 'translateX(24px)';
        applySlowedReverbEffect();
    } else {
        toggle.classList.remove('active');
        knob.style.transform = 'translateX(0)';
        removeSlowedReverbEffect();
    }
}

function applySlowedReverbEffect() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        sourceNode = audioContext.createMediaElementSource(audio);
    }

    // Reverb effect
    if (!reverbNode) {
        reverbNode = audioContext.createConvolver();
        const impulseLength = 1 * audioContext.sampleRate;
        const impulse = audioContext.createBuffer(2, impulseLength, audioContext.sampleRate);
        const left = impulse.getChannelData(0);
        const right = impulse.getChannelData(1);
        for (let i = 0; i < impulseLength; i++) {
            left[i] = right[i] = (Math.random() * 2 - 1) * Math.pow(1 - i / impulseLength, 2);
        }
        reverbNode.buffer = impulse;
    }

    const gainNode = audioContext.createGain();
    gainNode.gain.setValueAtTime(0.6, audioContext.currentTime); // Adjust this value to control the wet/dry mix

    // Slow down the audio (which also lowers the pitch)
    audio.preservesPitch = false;
    audio.playbackRate = 0.8; // Adjust this value to control the slowdown effect

    sourceNode.disconnect();
    sourceNode.connect(gainNode);
    gainNode.connect(audioContext.destination); // Dry signal
    sourceNode.connect(reverbNode);
    reverbNode.connect(audioContext.destination); // Wet signal
}

function removeSlowedReverbEffect() {
    audio.playbackRate = 1;
    audio.preservesPitch = true;

    if (sourceNode) {
        sourceNode.disconnect();
        if (reverbNode) {
            reverbNode.disconnect();
        }
        sourceNode.connect(audioContext.destination);
    }
}

function PlayAudio(audio_url, song_id) {
    var source = document.getElementById('audioSource');
    source.src = audio_url;
    var name = document.getElementById(song_id+"-n").textContent;
    var album = document.getElementById(song_id+"-a").textContent;
    var image = document.getElementById(song_id+"-i").getAttribute("src");
    
    document.title = name+" - "+album;
    document.getElementById("player-name").innerHTML = name;
    document.getElementById("player-album").innerHTML = album;
    document.getElementById("player-image").setAttribute("src",image);

    var promise = audio.load();
    if (promise) {
        promise.catch(function(error) { console.error(error); });
    }
    audio.play();
    updatePlayPauseButton(true);

    if (slowedReverbEnabled) {
        applySlowedReverbEffect();
    } else {
        removeSlowedReverbEffect();
    }
}
    </script>
</body>
</html>
